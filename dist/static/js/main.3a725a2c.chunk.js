(window.webpackJsonpcrop=window.webpackJsonpcrop||[]).push([[0],{146:function(t,e,i){t.exports=i(300)},151:function(t,e,i){},152:function(t,e,i){},153:function(t,e,i){},154:function(t,e,i){},155:function(t,e,i){},156:function(t,e,i){},201:function(t,e,i){},299:function(t,e,i){},300:function(t,e,i){"use strict";i.r(e);var s=i(1),n=i.n(s),a=i(7),o=i.n(a),h=(i(151),i(152),i(25)),l=i(26),r=i(29),u=i(27),c=i(28),m=(i(153),i(154),i(155),i(156),function(t){function e(t){var i;return Object(h.a)(this,e),(i=Object(r.a)(this,Object(u.a)(e).call(this,t))).stratPosition={x:0,y:0},i.translate={x:0,y:0},i.style={width:50,height:50,left:0,top:0},i.canvasSource=document.createElement("canvas"),i.canvasResult=document.createElement("canvas"),i.init(),i.state={style:i.style,cutImgUrl:"",imgType:"image/jpeg"},i}return Object(c.a)(e,t),Object(l.a)(e,[{key:"setImgType",value:function(t){this.cutImg(),this.setState({imgType:t})}},{key:"init",value:function(){this.style={width:50,height:50,left:0,top:0},this.stratPosition={x:0,y:0},this.translate={x:0,y:0},this.setState({style:this.style,cutImgUrl:""})}},{key:"getCutDomPosition",value:function(){var t=document.querySelector(".cut");if(!t)return null;var e=t.offsetWidth||this.style.width,i=t.offsetHeight||this.style.height,s=t.offsetLeft||this.style.left,n=t.offsetTop||this.style.top;return{width:e,height:i,left:s,top:n,right:s+e,bottom:n+i}}},{key:"componentDidMount",value:function(){}},{key:"componentWillReceiveProps",value:function(t){var e=this;t.showCut&&""!==t.imgUrl&&setTimeout(function(){e.cutImg()})}},{key:"cutMouseDown",value:function(t,e){var i=this;if(0===e.button){var s=function(t){i.cutMouseMove(t)};document.addEventListener("mousemove",s,!0),document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",s,!0)})}}},{key:"cutMouseMove",value:function(t){t.preventDefault(),this.translate={x:t.movementX,y:t.movementY},this.move()}},{key:"cutMouseUp",value:function(t){this.cutMoving=!1}},{key:"stretchMouseDown",value:function(t,e){var i=this;if(0===e.button){this.stratPosition={x:e.pageX,y:e.pageY};var s=function(t){i.stretchMouseMove(t)};document.addEventListener("mousemove",s,!0),document.addEventListener("mouseup",function(){document.removeEventListener("mousemove",s,!0)}),e.stopPropagation()}}},{key:"stretchMouseMove",value:function(t){this.stretchCutDom(t.movementX,t.movementY)}},{key:"stretchMouseUp",value:function(t,e){}},{key:"stretchCutDom",value:function(t,e){var i=this.getCutDomPosition();this.style.width+=t,this.style.height+=e,i.right>this.props.limit.width&&(this.style.width=this.props.limit.width-i.left),i.bottom>this.props.limit.height&&(this.style.height=this.props.limit.height-i.top),this.setState({style:this.style}),this.cutImg(this.props.imgUrl)}},{key:"move",value:function(){var t=this.getCutDomPosition();this.style.left+=this.translate.x,this.style.top+=this.translate.y,this.style.left<0&&(this.style.left=0),this.style.left+t.width>=this.props.limit.width&&(this.style.left=this.props.limit.width-t.width),this.style.top<0&&(this.style.top=0),this.style.top+t.height>=this.props.limit.height&&(this.style.top=this.props.limit.height-t.height),this.setState({style:this.style}),this.cutImg(this.props.imgUrl)}},{key:"cutImg",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.props.imgUrl,i=this.getCutDomPosition();if(i){var s=this.canvasSource,n=this.canvasResult;s.width=this.props.limit.width,s.height=this.props.limit.height,n.width=i.width,n.height=i.height;var a=s.getContext("2d"),o=n.getContext("2d"),h=new Image;h.src=e,h.width=s.width,h.height=s.height,h.onload=function(){a.drawImage(h,0,0,s.width,s.height);var e=a.getImageData(i.left,i.top,n.width,n.height);o.putImageData(e,0,0,0,0,n.width,n.height);var l=n.toDataURL(t.state.imgType);console.log(l),document.querySelector("#resultImg").src=l,t.setState({cutImgUrl:l}),t.props.cutFinish()}}}},{key:"cutImgMouseDown",value:function(t,e){e.preventDefault()}},{key:"cutImgMouseMove",value:function(t,e){e.preventDefault()}},{key:"cutImgMouseUp",value:function(t,e){e.preventDefault()}},{key:"render",value:function(t){return n.a.createElement("div",{className:"cut ".concat(this.props.showCut?"":"hide"),onMouseDown:this.cutMouseDown.bind(this,t),style:{width:this.state.style.width+"px",height:this.state.style.height+"px",left:this.state.style.left+"px",top:this.state.style.top+"px"}},n.a.createElement("div",{className:"size-text"}," ",this.state.style.width+" x "+this.state.style.height),""!==this.state.cutImgUrl?n.a.createElement("img",{src:this.state.cutImgUrl,id:"result_img",onMouseDown:this.cutImgMouseDown.bind(this,t),onMouseMove:this.cutImgMouseMove.bind(this,t),onMouseUp:this.cutImgMouseUp.bind(this,t)}):"",n.a.createElement("div",{className:"stretch l-t",onMouseDown:this.stretchMouseDown.bind(this,t),onMouseUp:this.stretchMouseUp.bind(this,t)}))}}]),e}(n.a.Component)),g=i(23),d=function(t){function e(t){var i;return Object(h.a)(this,e),(i=Object(r.a)(this,Object(u.a)(e).call(this,t))).imgsType=["image/jpeg","image/png","image/webp"],i.imgsSize=10485760,i.imgReal={width:"500px",height:"500px"},i.state={imgReal:i.imgReal,limit:{},fileEnterArea:!1,imgUrl:"",showCut:!1},i}return Object(c.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){}},{key:"selectFile",value:function(){this.fileInput.click()}},{key:"clickFile",value:function(t){this.processFile(this.fileInput.files),this.fileInput.value=""}},{key:"delImg",value:function(){this.cut.init(),this.setState({imgReal:{width:"500px",height:"500px"},imgUrl:"",fileEnterArea:!1,showCut:!1})}},{key:"imgShow",value:function(t){var e=this;this.setState({imgUrl:t,showCut:!0});var i=document.querySelector(".droparea");setTimeout(function(){var t={left:i.offsetLeft,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight,right:i.offsetLeft+i.offsetWidth,width:i.offsetWidth,height:i.offsetHeight};e.setState({limit:t})}),this.props.loadingImgFinish({width:i.offsetWidth,height:i.offsetHeight})}},{key:"processFile",value:function(t){var e=this;if(0!==(t=this.getFile(t)).length){var i=new FileReader;i.readAsDataURL(t[0]),i.onload=function(){e.imgShow(i.result),e.getImgReal(i.result)}}}},{key:"getImgReal",value:function(t){var e=this,i=new Image;i.src=t,i.onload=function(){e.imgReal.width=i.width+"px",e.imgReal.height=i.height+"px",e.setState({imgReal:e.imgReal})}}},{key:"getFile",value:function(t){var e=this;return Array.from(t).filter(function(t){return e.checkFile(t)})}},{key:"checkFile",value:function(t){var e=t.type,i=t.size,s=!0;return this.imgsType.includes(e)||(s=!1,console.error("\u6587\u4ef6\u4e0d\u662f\u56fe\u7247\u7c7b\u578b ".concat(e))),i>=this.imgsSize&&(s=!1,console.error("\u6587\u4ef6\u8d85\u8fc7".concat(i))),s}},{key:"onDragOver",value:function(t){t.preventDefault()}},{key:"onDrop",value:function(t,e){e.preventDefault(),this.state.imgUrl||(this.setState({fileEnterArea:!1}),this.processFile(e.dataTransfer.files))}},{key:"onDragEnter",value:function(){this.state.imgUrl||this.setState({fileEnterArea:!0})}},{key:"onDragLeave",value:function(){this.state.imgUrl||this.setState({fileEnterArea:!1})}},{key:"save",value:function(){var t=document.querySelector("#result_img"),e=document.createElement("a");e.download="\u526a\u88c1\u6587\u4ef6",e.href=t.src,e.dataset.downloadUrl=[e.download,e.href].join(":"),document.body.appendChild(e),e.click(),document.body.removeChild(e)}},{key:"cutFinish",value:function(){this.props.cutFinish()}},{key:"setImgType",value:function(t){this.cut.setImgType(t)}},{key:"render",value:function(t){var e=this;return n.a.createElement("div",{className:"droparea ".concat(this.state.fileEnterArea?"file-hover":""," ").concat(this.state.showCut?"no-border":""),onDragOver:this.onDragOver.bind(this),onDragEnter:this.onDragEnter.bind(this),onDragLeave:this.onDragLeave.bind(this),onDrop:this.onDrop.bind(this,t),style:{width:this.state.imgReal.width,height:this.state.imgReal.height}},n.a.createElement("div",{className:"desc ".concat(this.state.showCut?"hide":"")},n.a.createElement(g.a,{type:"primary",onClick:this.selectFile.bind(this),className:"imgbtn"},"\u4e0a\u4f20\u56fe\u7247"),n.a.createElement("span",null,"\u6216\u8005\u9009\u62e9\u4e00\u5f20\u56fe\u7247\u62d6\u62fd\u5230\u8fd9\u91cc~")),n.a.createElement("input",{className:"hide",type:"file",ref:function(t){return e.fileInput=t},onChange:this.clickFile.bind(this)}),this.state.imgUrl?n.a.createElement("img",{src:this.state.imgUrl,id:"source"}):null,n.a.createElement("div",{className:"layer ".concat(this.state.showCut?"":"hide")}),n.a.createElement(m,{cutFinish:this.cutFinish.bind(this),limit:this.state.limit,showCut:this.state.showCut,imgUrl:this.state.imgUrl,ref:function(t){return e.cut=t}}))}}]),e}(n.a.Component),p=i(76),f=(i(201),i(61)),v=i(303),y=i(302),w=i(301),k=f.a.Option,b=function(t){function e(t){var i;Object(h.a)(this,e),i=Object(r.a)(this,Object(u.a)(e).call(this,t));var s=Object(p.a)(i);return i.state={showOption:!1,imgType:"image/jpeg",columns:[{title:"\u53c2\u6570",dataIndex:"name",key:"name",render:function(t){return n.a.createElement("span",null,t)}},{title:"\u503c",dataIndex:"value",key:"value",render:function(t,e,i){return"3"!==e.key?n.a.createElement(v.a,{value:t,key:"input"}):"3"===e.key?n.a.createElement(f.a,{key:"Select",defaultValue:e.type,style:{width:120},onChange:s.handleChange.bind(s)},n.a.createElement(k,{value:"image/jpeg",key:"0"},"JPEG"),n.a.createElement(k,{value:"image/png",key:"1"},"PNG"),n.a.createElement(k,{value:"image/webp",key:"2"},"WEBP")):void 0}}],data:[{key:"1",name:"\u5c3a\u5bf8",value:""},{key:"2",name:"\u526a\u88c1\u540e\u5927\u5c0f",value:""},{key:"3",name:"\u683c\u5f0f",type:"JPEG"}]},i}return Object(c.a)(e,t),Object(l.a)(e,[{key:"handleChange",value:function(t){this.setState({imgType:t}),this.props.setImgType(t)}},{key:"delImg",value:function(){this.props.delImg(),this.setState({showOption:!1})}},{key:"save",value:function(){this.props.save(this.state.imgType)}},{key:"loadingImgFinish",value:function(){this.setState({showOption:!0})}},{key:"getImgSize",value:function(){var t=document.querySelector("#resultImg").src,e=(t=t.substring(t.indexOf("base64,")+"base64,".length)).indexOf("="),i=(t=-1!==e?t.substring(0,e):t).length;return parseFloat(Number(i-i/8*2)/1024).toFixed(2)+"KB"}},{key:"cutFinish",value:function(){var t=document.querySelector("#resultImg"),e=this.state.data;e[0].value=t.width+"x"+t.height,e[1].value=this.getImgSize(),this.setState({data:e})}},{key:"selectFile",value:function(){this.props.selectFile()}},{key:"render",value:function(){return n.a.createElement("div",{className:"option ".concat(this.state.showOption?"":"hide")},n.a.createElement(y.a,{columns:this.state.columns,dataSource:this.state.data}),n.a.createElement(g.a,{onClick:this.save.bind(this),type:"primary",style:{marginRight:"20px"}},"\u4fdd\u5b58"),n.a.createElement(w.a,{placement:"top",title:"\u786e\u8ba4\u6e05\u9664\u5417\uff1f\uff1f",onConfirm:this.delImg.bind(this),okText:"\u662f",cancelText:"\u5426"},n.a.createElement(g.a,{type:"danger"},"\u6e05\u9664")))}}]),e}(n.a.Component),E=(i(299),f.a.Option,function(t){function e(t){var i;return Object(h.a)(this,e),(i=Object(r.a)(this,Object(u.a)(e).call(this,t))).state={showResultDom:!1},i}return Object(c.a)(e,t),Object(l.a)(e,[{key:"componentWillReceiveProps",value:function(t){this.setState({showResultDom:t.showResultDom})}},{key:"handleChange",value:function(){}},{key:"render",value:function(){return n.a.createElement("div",{className:"result ".concat(this.state.showResultDom?"":"hide")},n.a.createElement("div",{className:"imgbox"},n.a.createElement("img",{src:"",id:"resultImg"})))}}]),e}(n.a.Component)),I=function(t){function e(t){var i;return Object(h.a)(this,e),(i=Object(r.a)(this,Object(u.a)(e).call(this,t))).state={showResultDom:!1,img:{width:0,height:0}},i}return Object(c.a)(e,t),Object(l.a)(e,[{key:"delImg",value:function(){this.droparea.delImg(),this.setState({showResultDom:!1})}},{key:"save",value:function(){this.droparea.save()}},{key:"loadingImgFinish",value:function(t){var e=t.width,i=t.height;this.option.loadingImgFinish(),this.setState({img:{width:e,height:i}}),this.showResult()}},{key:"showResult",value:function(){this.setState({showResultDom:!0})}},{key:"selectFile",value:function(){this.droparea.selectFile()}},{key:"cutFinish",value:function(){this.option.cutFinish()}},{key:"setImgType",value:function(t){this.droparea.setImgType(t)}},{key:"render",value:function(t){var e=this;return n.a.createElement("div",{className:"imgcrop"},n.a.createElement(d,{cutFinish:this.cutFinish.bind(this),selectFile:this.selectFile.bind(this),size:10485760,ref:function(t){e.droparea=t},loadingImgFinish:this.loadingImgFinish.bind(this),showResult:this.showResult.bind(this)}),n.a.createElement(E,{showResultDom:this.state.showResultDom,img:this.state.img,ref:function(t){return e.result=t}}),n.a.createElement("div",{className:"clear"}),n.a.createElement(b,{setImgType:this.setImgType.bind(this),selectFile:this.selectFile.bind(this),delImg:this.delImg.bind(this),save:this.save.bind(this),ref:function(t){e.option=t}}))}}]),e}(n.a.Component),D=function(t){function e(t){var i;return Object(h.a)(this,e),(i=Object(r.a)(this,Object(u.a)(e).call(this,t))).state={},i}return Object(c.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return n.a.createElement("div",{className:"imgcrop-page"},n.a.createElement(I,null))}}]),e}(n.a.Component);var O=function(){return n.a.createElement("div",{className:"App"},n.a.createElement(D,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[146,1,2]]]);
//# sourceMappingURL=main.3a725a2c.chunk.js.map